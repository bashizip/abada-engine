version: '3.8'

services:
  # Abada Engine - Usage from Docker Hub
  abada-engine:
    # Use image from Docker Hub instead of local build
    image: ${DOCKER_USERNAME:-bashizip}/abada-engine:${VERSION:-latest}
    build:
      context: .
      dockerfile: Dockerfile.prod # Point to prod dockerfile just in case build is forced, but image takes precedence
    pull_policy: always
    restart: always

  # Abada Tenda - Frontend
  abada-tenda:
    image: ${DOCKER_USERNAME:-bashizip}/abada-tenda:${VERSION:-latest}
    container_name: abada-tenda-prod
    ports:
      - "5602:5602"
    environment:
      - NODE_ENV=production
    networks:
      - abada-network
    restart: always
    pull_policy: always
    healthcheck:
      test: [ "CMD", "wget", "--spider", "-q", "http://localhost:5602/health" ]
      interval: 30s
      timeout: 10s
      retries: 3

  # Abada Orun - Frontend
  abada-orun:
    image: ${DOCKER_USERNAME:-bashizip}/abada-orun:${VERSION:-latest}
    container_name: abada-orun-prod
    ports:
      - "5603:5603"
    environment:
      - NODE_ENV=production
    networks:
      - abada-network
    restart: always
    pull_policy: always
    healthcheck:
      test: [ "CMD", "wget", "--spider", "-q", "http://localhost:5603/health" ]
      interval: 30s
      timeout: 10s
      retries: 3
