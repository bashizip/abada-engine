# Abada Engine v0.8.3-alpha Release Notes

**Release Date**: November 21, 2025  
**Status**: Alpha Release  
**Focus**: Observability & Insights

---

## Overview

Version 0.8.3-alpha introduces a comprehensive observability stack to the Abada Engine, providing deep visibility into runtime behavior and enabling effective production diagnostics. This release implements the **three pillars of observability** using industry-standard OpenTelemetry protocols and tools.

> **Roadmap Context**: This release completes the first milestone in the [Roadmap to Beta](../development/roadmap.md), establishing the observability foundation required for production-ready deployments.

---

## What's New

### üîç Distributed Tracing

Full distributed tracing implementation using **OpenTelemetry** and **Jaeger** for end-to-end request tracking:

- **Automatic Instrumentation**: HTTP requests are automatically traced via Spring Boot integration
- **Manual Instrumentation**: Custom spans for all core engine operations:
  - Process deployment and execution
  - Task lifecycle (create, claim, complete, fail)
  - Event correlation (messages, signals)
  - Job scheduling and execution
- **Trace Context Propagation**: Seamless context propagation across all operations
- **Rich Span Attributes**: Detailed metadata including process IDs, task keys, user names, and correlation keys

**Key Spans**:
- `abada.process.deploy` - Process definition deployment
- `abada.process.start` - Process instance creation
- `abada.task.create/claim/complete` - Task lifecycle operations
- `abada.event.correlate.message` - Message event correlation
- `abada.event.broadcast.signal` - Signal event broadcasting
- `abada.job.schedule/execute` - Job operations

### üìä Metrics Collection

Comprehensive metrics using **Micrometer** and **Prometheus** for performance monitoring:

#### Process Metrics
- `abada.process.instances.started` - Total process instances started
- `abada.process.instances.completed` - Total process instances completed
- `abada.process.instances.failed` - Total process instances failed
- `abada.process.duration` - Process execution duration histogram
- `abada.process.instances.active` - Currently active process instances

#### Task Metrics
- `abada.tasks.created/claimed/completed/failed` - Task lifecycle counters
- `abada.task.waiting_time` - Time from creation to claim (SLA tracking)
- `abada.task.processing_time` - Time from claim to completion
- `abada.tasks.active` - Currently active tasks

#### Event Metrics
- `abada.events.published/consumed/correlated` - Event processing counters

#### Job Metrics
- `abada.jobs.executed/failed` - Job execution counters
- `abada.job.execution_time` - Job execution duration

All metrics include appropriate labels for filtering and aggregation (e.g., `process.definition.id`, `task.definition.key`, `event.type`).

### üìù Centralized Log Aggregation

Structured logging with **Loki** and **Promtail** for centralized log management:

- **File-Based Collection**: Promtail tails application log files and forwards to Loki
- **Trace Correlation**: Automatic inclusion of `traceId` and `spanId` in all log entries
- **Structured Logging**: JSON-formatted logs with rich metadata
- **Efficient Storage**: Label-based indexing for fast queries and lower storage costs
- **Retention Policy**: 14-day log retention with configurable limits
- **High Volume Support**: Configured for 50MB/s ingestion rate

**Log Format**:
```
2024-01-15 10:30:45.123 [thread] INFO [traceId,spanId] logger - message
```

### üìà Grafana Dashboards

Two pre-built Grafana dashboards for real-time monitoring:

#### 1. Abada Engine Overview Dashboard
Located at `monitoring/grafana/dashboards/abada-engine-overview.json`

Provides high-level system health metrics:
- Process execution rates and completion statistics
- Task throughput and performance
- Event processing metrics
- System health indicators

#### 2. Task Details Dashboard
Located at `monitoring/grafana/dashboards/abada-task-details.json`

Offers detailed task-level insights:
- Task waiting and processing time distributions (p50, p95, p99)
- Task creation and completion rates by type
- Success/failure ratios with visual indicators
- Completion rate gauges with threshold alerts

### üèóÔ∏è Infrastructure Components

Complete observability stack deployment via Docker Compose:

- **OpenTelemetry Collector**: Central telemetry data collection and routing
- **Jaeger**: Distributed tracing backend and UI (port 16686)
- **Prometheus**: Metrics storage and querying (port 9090)
- **Loki**: Log aggregation and storage (port 3100)
- **Promtail**: Log collection agent
- **Grafana**: Unified visualization platform (port 3000)

All components are pre-configured and ready to use with `docker-compose up`.

---

## Technical Implementation

### Dependencies Added

```xml
<!-- OpenTelemetry -->
<dependency>
    <groupId>io.opentelemetry.instrumentation</groupId>
    <artifactId>opentelemetry-spring-boot-starter</artifactId>
    <version>2.21.0</version>
</dependency>

<!-- Micrometer OTLP Registry -->
<dependency>
    <groupId>io.micrometer</groupId>
    <artifactId>micrometer-registry-otlp</artifactId>
    <version>1.15.4</version>
</dependency>

<!-- OpenTelemetry Logback Appender -->
<dependency>
    <groupId>io.opentelemetry.instrumentation</groupId>
    <artifactId>opentelemetry-logback-appender-1.0</artifactId>
    <version>2.10.0-alpha</version>
</dependency>

<!-- Logstash Logback Encoder -->
<dependency>
    <groupId>net.logstash.logback</groupId>
    <artifactId>logstash-logback-encoder</artifactId>
    <version>8.0</version>
</dependency>
```

### Configuration Files

- **[logback-spring.xml](file:///home/pbashizi/IdeaProjects/abada-engine/src/main/resources/logback-spring.xml)**: Logging configuration with file appender and trace correlation
- **[docker/otel-collector-config.yml](file:///home/pbashizi/IdeaProjects/abada-engine/docker/otel-collector-config.yml)**: OpenTelemetry Collector pipeline configuration
- **[docker/loki-config-dev.yaml](file:///home/pbashizi/IdeaProjects/abada-engine/docker/loki-config-dev.yaml)**: Loki storage and ingestion configuration
- **[docker/promtail-config.yaml](file:///home/pbashizi/IdeaProjects/abada-engine/docker/promtail-config.yaml)**: Promtail log collection configuration

### Core Components

- **`ObservabilityConfig`**: Central OpenTelemetry SDK configuration
- **`EngineMetrics`**: Centralized metrics management for all engine operations
- **Manual Instrumentation**: Custom spans and metrics in core engine components

---

## Getting Started

### Quick Start

1. **Start the observability stack**:
   ```bash
   docker-compose up -d
   ```

2. **Access the dashboards**:
   - Grafana: http://localhost:3000 (admin/admin)
   - Jaeger: http://localhost:16686
   - Prometheus: http://localhost:9090

3. **Import Grafana dashboards**:
   - Navigate to Grafana ‚Üí Dashboards ‚Üí Import
   - Upload `monitoring/grafana/dashboards/abada-engine-overview.json`
   - Upload `monitoring/grafana/dashboards/abada-task-details.json`

4. **Configure data sources** (if not auto-provisioned):
   - Prometheus: http://prometheus:9090
   - Jaeger: http://jaeger:16686
   - Loki: http://loki:3100

### Querying Logs

Use LogQL in Grafana Explore:

```logql
# All logs from abada-engine
{service_name="abada-engine"}

# Filter by log level
{service_name="abada-engine"} | json | level="ERROR"

# Logs for a specific trace
{service_name="abada-engine"} | json | traceId="abc123def456"

# Search for specific text
{service_name="abada-engine"} |= "process instance"
```

### Trace-to-Logs Workflow

1. Find a trace in Jaeger (http://localhost:16686)
2. Copy the trace ID
3. In Grafana Explore, query Loki:
   ```logql
   {service_name="abada-engine"} | json | traceId="<paste-trace-id>"
   ```
4. View all logs associated with that specific request

---

## Documentation

New and updated documentation:

- **[observability-implementation.md](file:///home/pbashizi/IdeaProjects/abada-engine/docs/observability-implementation.md)**: Implementation overview and testing guide
- **[observability-reference-guide.md](file:///home/pbashizi/IdeaProjects/abada-engine/docs/observability-reference-guide.md)**: Comprehensive reference for all observability features
- **[loki-integration-walkthrough.md](file:///home/pbashizi/IdeaProjects/abada-engine/docs/loki-integration-walkthrough.md)**: Step-by-step Loki integration guide

---

## Breaking Changes

None. This release is fully backward compatible with v0.8.2-alpha.

---

## Bug Fixes

- Fixed Loki permission denied errors in Docker containers
- Resolved file appender conflicts in test environments (logs now only write to files in non-test profiles)
- Fixed Grafana dashboard provisioning configuration

---

## Known Issues

- Loki ingestion rate limits may need tuning for very high-volume deployments (currently set to 50MB/s)
- Some log queries in Grafana may be slow for large time ranges (use smaller time windows for better performance)

---

## Performance Impact

The observability stack has minimal performance overhead:

- **Memory**: ~1MB per 1000 active spans
- **CPU**: <1% overhead with default sampling (100% in development)
- **Network**: Batch exports minimize bandwidth usage
- **Storage**: Logs retained for 14 days, metrics for 15 days (configurable)

For production deployments, consider:
- Reducing trace sampling to 1-10% for high-traffic scenarios
- Adjusting log retention based on compliance requirements
- Tuning batch export settings for optimal performance

---

## Upgrade Instructions

### From v0.8.2-alpha

1. **Update dependencies**:
   ```bash
   mvn clean install
   ```

2. **Update Docker Compose**:
   ```bash
   docker-compose pull
   docker-compose up -d
   ```

3. **No database migrations required** - this release only adds observability features

4. **Optional**: Import the new Grafana dashboards for enhanced monitoring

---

## What's Next

According to the [Roadmap to Beta](../development/roadmap.md), the next releases will focus on:

- **v0.8.4-alpha**: Tenda MVP (Tasklist UI) - Validate user task lifecycle from an end-user perspective
- **v0.8.5-alpha**: Orun MVP (Cockpit UI) - Validate process monitoring and history APIs
- **v0.9.0-alpha**: End-to-End Validation - Harden the engine with realistic workflows
- **v1.0.0-beta**: Early Adopter Release - Feature-complete and stable for real-world experiments

---

## Acknowledgments

This release implements industry best practices for observability:
- OpenTelemetry for vendor-neutral instrumentation
- Prometheus for reliable metrics collection
- Jaeger for distributed tracing
- Loki for efficient log aggregation
- Grafana for unified visualization

---

## Feedback

As this is an alpha release, we welcome feedback on:
- Dashboard usefulness and clarity
- Metric coverage and granularity
- Log query patterns and performance
- Documentation completeness

Please report issues or suggestions through the project's issue tracker.

---

**Full Changelog**: v0.8.2-alpha...v0.8.3-alpha
