# Abada Engine Release Notes - Version 0.7.0-alpha

This is a major feature release for the Abada Engine, introducing comprehensive support for advanced BPMN 2.0 constructs, including multiple gateway types and a new event-driven architecture. This release significantly enhances the engine's ability to model and execute complex, real-world business processes.

## ‚ú® Major Features

### 1. Parallel Gateway Support (`<parallelGateway>`)
The engine now fully supports BPMN Parallel Gateways for both forking and joining execution paths.
- **Forking**: A splitting parallel gateway will unconditionally create a new, concurrent path of execution for **every** outgoing sequence flow.
- **Joining**: A joining parallel gateway will wait until a token has arrived from **every** incoming sequence flow before the process continues.

### 2. Inclusive Gateway Support (`<inclusiveGateway>`)
The engine now supports BPMN Inclusive Gateways, allowing for conditional parallel execution.
- **Forking**: A splitting inclusive gateway evaluates the conditions on its outgoing flows. It will create a new, concurrent path for **each flow** whose condition evaluates to `true`. If no conditions match, the default flow is taken.
- **Joining**: A joining inclusive gateway will wait for all tokens that were created by the corresponding splitting gateway to arrive before proceeding.

### 3. Event-Based Gateway Foundation

A new, extensible event-driven architecture has been implemented to allow processes to pause and wait for external stimuli. This includes:
- A new `EventManager` service responsible for registering waiting process instances and correlating incoming events.
- A new `JobScheduler` service, backed by a persistent database table (`jobs`), for handling time-based events.

### 4. Message Event Support (`<intermediateCatchEvent>`)
Processes can now wait for a specific, named message correlated to that instance.
- **Point-to-Point Communication**: A process instance can pause its execution until an external system delivers a message with a matching `correlationKey`.
- **API**: The `EventManager.correlateMessage()` method provides the entry point for external systems to deliver these messages.

### 5. Timer Event Support (`<intermediateCatchEvent>`)
Processes can now include time-based delays.
- **Persistent Scheduling**: When a process reaches a timer event, a persistent job is created in the database.
- **Automatic Resumption**: The `JobScheduler` runs periodically in the background, automatically resuming processes when their timers are due.
- **ISO 8601 Durations**: Timer durations are specified using the standard ISO 8601 format (e.g., `PT10S` for 10 seconds, `PT5M` for 5 minutes).

### 6. Signal Event Support (`<intermediateCatchEvent>`)
The engine now supports broadcast-style communication using signals.
- **One-to-Many Broadcast**: A single signal, when broadcast, will be received by **all** process instances currently waiting for that signal name.
- **API**: The `EventManager.broadcastSignal()` method provides the entry point for broadcasting signals.

## üêõ Fixes & Improvements

- **Core Engine Refactoring**: The `ProcessInstance` model was fundamentally refactored to support multiple concurrent execution paths (`activeTokens`), providing the foundation for all parallel and inclusive gateway logic.
- **Corrected Parallel Execution Logic**: Fixed a critical bug where completing a task on one parallel branch would incorrectly cause duplicate tasks to be created on other waiting branches. The engine now correctly isolates execution paths.
- **Parser Improvements**: The `BpmnParser` has been enhanced to correctly recognize and parse generic `<task>` elements, treating them as user tasks. It was also updated to parse `<messageEventDefinition>`, `<timerEventDefinition>`, and `<signalEventDefinition>`.
- **Circular Dependency Resolution**: Resolved a complex circular dependency between the `AbadaEngine` and the new `JobScheduler` by correctly applying lazy initialization (`@Lazy`), allowing the application context to load successfully.
- **Test Suite Regressions**: Fixed multiple compilation errors and regressions in the existing test suite (`ProcessInstanceAdvanceTest`, `ProcessDefinitionTest`) that were caused by data model updates.
- **Bug Fix**: Corrected a bug in `ParsedProcessDefinition` where helper methods for retrieving candidate users and groups were missing a variable declaration.

## üìö Documentation

- **Event-Based Gateway Design**: A new architectural document (`docs/event-based-gateways-design.md`) has been created, outlining the design and implementation plan for all event types.
- **Process Variable Behavior**: A new document (`docs/process-variables.md`) has been added to clarify the lifecycle of process variables and explain the "Initial User Task Pattern" best practice.
- **Configuration Review**: A formal review of the project's configuration (`docs/project-configuration-review.md`) was conducted and documented, identifying potential security and maintainability improvements for future releases.

## ‚ö†Ô∏è Scope for This Release

- **Conditional Events**: As per a strategic decision, the **Conditional Event** type was **not** implemented in this release and is deferred to a future version.
- **Configuration Issues**: The issues identified in the configuration review (e.g., empty database password in dev, running as root in Docker) have been acknowledged but are deferred for a future hardening phase.
